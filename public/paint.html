<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>pixels</title>
		<link rel="stylesheet" type="text/css" href="paint_style.css">
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<header>
			<div id="instructions">Open your js console. Use ```paint(x, y, color)```. 
        <br>Coordinates are 0-150 with the origin at the upper left.
      <br>Color is a string representing a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value">css color</a>.</div>
			<div>
				<input type="checkbox" id="broadcast" name="broadcast" />
				<label for="broadcast">Broadcast?</label>
				<input type="checkbox" id="receive" name="receive" />
				<label for="receive">Receive?</label>
			</div>
		</header>
		<main id="main">
			<canvas id="display"></canvas>
		</main>
		<footer>
		</footer>
	</body>
	<script type="text/javascript">
		const canvasSize = 150;
		const pixelSize = 1;

		const broadcast = document.getElementById("broadcast");
		const receive = document.getElementById("broadcast");

		const canvas = document.getElementById("display");
		canvas.width = canvasSize*pixelSize;
		canvas.height = canvasSize* pixelSize;
		const ctx = canvas.getContext("2d");

		const socket = io();

		socket.on('connection', (socket) => {
			console.log('connected');
		});
		socket.on('paint', (data) => {
			if (receive.checked) {
				putPixel(data.x, data.y, data.color);
			}
		});

		function putPixel(x, y, color) {
			ctx.fillStyle = color;
			ctx.fillRect(x*pixelSize, y*pixelSize, pixelSize, pixelSize);
		}

		function paint(x, y, color) {
			if(x>=0 && x<canvasSize && y>=0 && y<canvasSize) {
				if (typeof color == "string") {
					putPixel(x, y, color);
					if (broadcast.checked) {
						socket.emit("paint", {x:x, y:y, color:color});
					}
					return "ok";
				}
				else return "color needs to be a string";
			}
			else {
				return "out of bounds";
			}
		}

		function clear() {
			ctx.clearRect(0,0, canvas.width, canvas.height);
		}
	</script>
</html>